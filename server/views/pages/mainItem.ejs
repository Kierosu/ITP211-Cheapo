<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TET</title>
	<!-- css -->
	<% include ../partials/stylesheet %>
</head>

<body>
	<!-- header -->
	<% include ../partials/header %>

		<div class="container">
			<% if (item.length > 0) { %>
				<% if(loginuser.userType == 'Admin'){ %> 
					<div style="height: 80px;width: 100%;">
						<div style="height: 100%;width: 20%;float: left;display: flex">
							<h1 style="margin: auto;">Listed Items</h1>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
								<a href="register" id="redBtn" class="btn btn-danger btn-lg" style="margin: auto">Add an user</a>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="reportsF()" style="margin: auto" class="btn btn-lg btn-info">Reports</button>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="itemsF()" style="margin: auto" class="btn btn-lg btn-info">Items</button>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="usersF()" style="margin: auto" class="btn btn-lg btn-info">Users</button>
						</div>						
					</div>
					<div id="adminItems" style="display: none">
						<% item.forEach(function(item){ %>						
							<% if(item.status == 'Auction'){ %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="/itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>						
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="width: 50%;float: left;display: flex;">Starting Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.basePrice %>
																<% } %>														
															<%})%>
														</p>
														<p style="width: 50%;float: left;display: flex;">Current Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.highestPrice %>
																<% } %>														
															<%})%>	
														</p>
													</div>													
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Status: <%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<div style="height: 100%;width: 15%;float: right;">
												<div style="height: 100%; width: 100%;">
													<div style="height: 50%;width: 100%;display: flex">
														<a onclick="return confirm('Are you sure you want to delete auction?')" href="items/canAuction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Cancel Auction</a>
													</div>
													<div style="height: 50%;width: 100%;display: flex;">
													<a href="/hello" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">View Auction</a>
													</div>		
												</div>												
											</div>
										</div>
									</div>									
								</form>
							<% } else { %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="itemImg">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>
													<div style="height: 34%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Price: $<%= item.price %></p>
													</div>
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;<%if(item.status == 'Deactivated'){%>color:red;<%}%>">Status:<%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<%if(item.status == 'Deactivated'){%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="/items/reactivate/<%= item.itemID %>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Reactivate</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}else{%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="items/auction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Auction</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}%>
										</div>
									</div>									
								</form>
							<% } %>							
						<% })%>
					</div>
					<div id="adminUsers" style="display: none">
						<% users.forEach(function(users){ %>						
							<form action="/items/edit" method="post" disabled>
								<div class="jumbotron jumbotron-fluid">
									<div class="container" style="overflow: hidden">
										<div style="height: 100px;width: 20%;float: left;display: flex;">
											<h1 style="margin: auto;height: 100%;">
												<img src="../img/<%= users.profilePic %>" style="height: 100%;width: 85%;font-size: 23px" alt="User IMG">
											</h1>
										</div>
										<div style="height: 100px;width: 15%;float: left;">
											<div style="height: 100%; width: 100%;">
												<div style="height: 50%;width: 100%;display: flex;">
													<h2 style="margin: auto;">
														<%= users.username %>
													</h2>
												</div>
												<div style="height: 50%;width: 100%;display: flex">
													<h4 style="margin: auto">
														<%= users.membership  %>
													</h4>
												</div>
											</div>
										</div>
										<div style="height: 100px;width: 50%;float: left;display: flex;">
											<h2 style="margin: auto">
												<%= users.email  %>
											</h2>
										</div>
										<div style="height: 100px;width: 15%;float: left;">											
											<div style="height: 100%; width: 100%;">
												<div style="height: 50%;width: 100%;display: flex;">
													<a href="user/edit/<%=users.userID%>" style="margin: auto;width: 50%;" class="btn btn-primary btn-sm">Edit</a>
												</div>
												<div style="height: 50%;width: 100%;display: flex">
													<a disable onclick="return confirm('Are you sure you want to delete?')" href="user/delete/<%=users.userID%>" style="margin: auto;width: 50%;"
													class="btn btn-primary btn-sm">Delete</a>
												</div>
											</div>												
										</div>
									</div>
								</div>
							</form>						
						<% })%>
					</div>
					<div id="adminReports">
						<% report.forEach(function(report){ %>												
						<form action="#" method="post">
								<div class="jumbotron jumbotron-fluid">
									<div class="container" style="overflow: hidden">
										<div style="height: 130px;width: 15%;float: left;display: flex">
											<h3 style="margin: auto;">
												By: <% users.forEach(function(users){ %>
													<% if(users.userID == report.userID){ %>
														<%= users.username %>
													<% } %>
													<% })%>
											</h3>
										</div>
										<div style="height: 130px;width: 25%;float: left;display: flex;">
											<h3 style="margin: auto">
											To: <% item.forEach(function(item){ %>
													<% if(item.itemID == report.itemID){ %>
														<%= item.name %>																		
														<% users.forEach(function(users){ %>
															<% if(item.userID == users.userID){ %>
															by	<%= users.username %> <%= item.warnings %>
															<% } %>
														<% })%>
													<% } %>
												<% })%>														
											</h3>
										</div>
										<div style="height: 130px;width: 45%;float: left;display: flex;">
											<h4 style="margin: auto">
												Report: <%= report.reportDetails %>
											</h4>
										</div>
										<div style="height: 130px;width: 15%;float: left">											
											<div style="height: 100%; width: 100%;background-color: bisque">												
												<div style="height: 50%;width: 100%;display: flex;background-color: aquamarine">
													<a href="reports/warn/<%= report.itemID %>/<%= report.reportID %>" style="margin: auto;"	class="btn btn-primary btn-sm">Warn</a>
												</div>
												<div style="height: 50%;width: 100%;display: flex">
													<a onclick="return confirm('Are you sure you want to ignore?')" href="reports/delete/<%= report.reportID %>" style="margin: auto;"
													class="btn btn-primary btn-sm">Ignore</a>
												</div>
											</div>												
										</div>
									</div>
								</div>
							</form>							
						<% })%>
					</div>
				<% } else { %> 
					<div id="memberItems">
						<div style="height: 80px;width: 100%;">
							<h1 style="float: left;">My listed items</h1>
							<a href="/items/add" class="btn btn-danger btn-lg" style="float: right;">Post an item</a>
						</div>
						<% item.forEach(function(item){ %>
							<% if(item.status == 'Auction'){ %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>						
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="width: 50%;float: left;display: flex;">Starting Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.basePrice %>
																<% } %>														
															<%})%>
														</p>
														<p style="width: 50%;float: left;display: flex;">Current Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.highestPrice %>
																<% } %>														
															<%})%>	
														</p>
													</div>													
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Status: <%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<div style="height: 100%;width: 15%;float: right;">
												<div style="height: 100%; width: 100%;">
													<div style="height: 50%;width: 100%;display: flex">
														<a onclick="return confirm('Are you sure you want to delete auction?')" href="items/canAuction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Cancel Auction</a>
													</div>
													<div style="height: 50%;width: 100%;display: flex;">
													<a href="/auctions/
													<% auction.forEach(function(auction){%>
														<% if(auction.itemAuctionID == item.itemID){ %>
															<%= auction.auctionID %>
														<% } %>														
													<%})%>/
													<% auction.forEach(function(auction){%>
														<% if(auction.itemAuctionID == item.itemID){ %>
															<%= auction.itemAuctionID %>
														<% } %>														
													<%})%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">View Auction</a>
													</div>		
												</div>												
											</div>
										</div>
									</div>									
								</form>
							<% } else { %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="TET">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>
													<div style="height: 34%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Price: $<%= item.price %></p>
													</div>
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;<%if(item.status == 'Deactivated'){%>color:red;<%}%>">Status:<%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<%if(item.status == 'Deactivated'){%>
												<div style="height: 100%;width: 15%;float: right;display: flex;">
													<div style="height: 80%; width: 80%;margin: auto;font-size: 32px;display: flex;">
														<p style="margin: auto;">Please seek help</p> 
													</div>												
												</div>
											<%}else{%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="items/auction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Auction</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}%>
										</div>
									</div>									
								</form>
							<% } %>					
						<% })%>
					</div>
				<% } %>		
			<% } else { %> 
				<div>
					<h1 style="float: left;">No items listed</h1>
					<a href="/items/add" class="btn btn-danger btn-lg" style="float: right;">Post an item</a>
				</div>	
			<% } %>
		</div>
		<br>
		<script>
			function reportsF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				var redBtn = document.getElementById("redBtn");
				i.style.display = "none";
				u.style.display = "none";
				r.style.display = "block";
				redBtn.innerHTML = "";
				redBtn.href = "#";
			}			
			function itemsF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				i.style.display = "block";
				u.style.display = "none";
				r.style.display = "none";
				redBtn.innerHTML = "Add an item";
				redBtn.href = "items/add";
			}			
			function usersF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				i.style.display = "none";
				u.style.display = "block";
				r.style.display = "none";
				redBtn.innerHTML = "Add an user";
				redBtn.href = "register";
			}			
		</script>
		<% include ../partials/footer %>
		<!-- jQuery Plugins -->
		<% include ../partials/javascript %>
		<script>
		</script>
</body>

</html>