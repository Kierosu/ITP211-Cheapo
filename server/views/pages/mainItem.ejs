<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cheapo</title>
	<!-- css -->
	<% include ../partials/stylesheet %>
</head>

<body>
	<!-- header -->
	<% include ../partials/header %>

		<div class="container">
			<% if (item.length > 0) { %>
				<% if(loginuser.userType == 'Admin'){ %> 
					<div style="height: 80px;width: 100%;">
						<div style="height: 100%;width: 20%;float: left;display: flex">
							<h1 style="margin: auto;">Listed Items</h1>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
								<a href="register" id="redBtn" class="btn btn-danger btn-lg" style="margin: auto">Add an user</a>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="reportsF()" style="margin: auto" class="btn btn-lg btn-info">Reports</button>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="itemsF()" style="margin: auto" class="btn btn-lg btn-info">Items</button>
						</div>
						<div style="height: 100%;width: 20%;float: right;display: flex;">
							<button onclick="usersF()" style="margin: auto" class="btn btn-lg btn-info">Users</button>
						</div>						
					</div>
					<div id="adminItems" style="display: block">
						<% item.forEach(function(item){ %>						
							<% if(item.status == 'Auction'){ %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="/itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>						
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="width: 50%;float: left;display: flex;">Starting Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.basePrice %>
																<% } %>														
															<%})%>
														</p>
														<p style="width: 50%;float: left;display: flex;">Current Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.highestPrice %>
																<% } %>														
															<%})%>	
														</p>
													</div>													
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Status: <%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<div style="height: 100%;width: 15%;float: right;">
												<div style="height: 100%; width: 100%;">
													<div style="height: 50%;width: 100%;display: flex">
														<a onclick="return confirm('Are you sure you want to delete auction?')" href="items/canAuction/<%=item.itemID%>" style="margin: auto;" class="btn btn-primary btn-sm">Cancel Auction</a>
													</div>
													<div style="height: 50%;width: 100%;display: flex;">
														<a href="/auctions/
														<% auction.forEach(function(auction){%>
															<% if(auction.itemAuctionID == item.itemID){ %>
																<%= auction.auctionID %>
															<% } %>														
														<%})%>/
														<% auction.forEach(function(auction){%>
															<% if(auction.itemAuctionID == item.itemID){ %>
																<%= auction.itemAuctionID %>
															<% } %>														
														<%})%>" style="margin: auto;" class="btn btn-primary btn-sm">View Auction</a>
													</div>		
												</div>												
											</div>
										</div>
									</div>									
								</form>
							<% } else { %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="itemImg">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>
													<div style="height: 34%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Price: $<%= item.price %></p>
													</div>
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;<%if(item.status == 'Deactivated'){%>color:red;<%}%>">Status:<%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<%if(item.status == 'Deactivated'){%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="/items/reactivate/<%= item.itemID %>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Reactivate</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}else{%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="items/auction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Auction</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}%>
										</div>
									</div>									
								</form>
							<% } %>							
						<% })%>
					</div>
					<div id="adminUsers" style="display: none">
						<% users.forEach(function(users){ %>		
							<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
								<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
									<div style="height: 100%;width: 30%;float: left;display: flex;">												
										<img src="/img/<%= users.profilePic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
									</div>
									<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
										<div style="height: 100%;width: 100%;font-size: 32px;">
											<div style="height: 25%;width: 100%;display: flex;">
												<p style="margin: auto 0;">Username: <b><%= users.username %></b></p>
											</div>						
											<div style="height: 25%;width: 100%;display: flex;">
												<p style="width: 50%;float: left;display: flex;">Email: <b><%= users.email %></b></p>
											</div>													
											<div style="height: 25%;width: 100%;display: flex;">
												<p style="margin: auto 0;">Type: <b><%= users.userType %></b></p>
											</div>
											<div style="height: 25%;width: 100%;display: flex;">
												<p style="margin: auto 0;">2FA: <b><%= users.TwoFA %></b></p>
											</div>
										</div>
									</div>
									<div style="height: 100%;width: 15%;float: right;">
										<div style="height: 100%; width: 100%;">
											<div style="height: 50%;width: 100%;display: flex">
												<a href="#" style="margin: auto;" class="btn btn-primary btn-sm">Edit User</a>
											</div>
											<div style="height: 50%;width: 100%;display: flex;">
												<a href="#" onclick="javascript:location.href='daw'" style="margin: auto;" class="btn btn-primary btn-sm">Delete User</a>
											</div>		
										</div>												
									</div>
								</div>
							</div>					
						<% })%>
					</div>
					<div id="adminReports" style="display: none">
						<% report.forEach(function(report){ %>		
							<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
								<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
									<div style="height: 100%;width: 30%;float: left;display: flex;">												
										<img src="/itemImg/<% item.forEach(function(item){ %>
																<% if(item.itemID == report.itemID){ %>
																	<%= item.itemPic %>	
																<% } %>
															<% })%>" 
										style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
									</div>
									<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
										<div style="height: 55%;width: 100%;font-size: 32px;">
											<div style="height: 33%;width: 100%;display: flex;">
												<p style="margin: auto 0;">Item Name: 
													<% item.forEach(function(item){ %>
														<% if(item.itemID == report.itemID){ %>
															<b><%= item.name %></b>	
														<% } %>
													 <% })%>	
												</p>
											</div>						
											<div style="height: 33%;width: 100%;display: flex;">
												<p style="width: 50%;float: left;display: flex;">Owner:&nbsp;
														<% item.forEach(function(item){ %>
															<% if(item.itemID == report.itemID){ %>																		
																<% users.forEach(function(users){ %>
																	<% if(item.userID == users.userID){ %>
																	<b><%= users.username %></b>
																	<% } %>
																<% })%>
															<% } %>
														<% })%>
												</p>
												<p style="width: 50%;float: left;display: flex;">Warnings:&nbsp;
														<% item.forEach(function(item){ %>
															<% if(item.itemID == report.itemID){ %>																		
																<b><%= item.warnings %></b>
															<% } %>
														<% })%>
												</p>
											</div>													
											<div style="height: 33%;width: 100%;display: flex;">
												<p style="margin: auto 0;">Reporter: 
													<% users.forEach(function(users){ %>
														<% if(users.userID == report.userID){ %>
															<b><%= users.username %></b>
														<% } %>
													<% })%>
												</p>
											</div>
										</div>
										<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
											<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;">Report: <b><%= report.reportDetails %></b></p>
										</div>
									</div>
									<div style="height: 100%;width: 15%;float: right;">
										<div style="height: 100%; width: 100%;">
											<div style="height: 33%;width: 100%;display: flex">
												<a onclick="return confirm('Warn User?')" href="reports/warn/<%= report.itemID %>/<%= report.reportID %>" style="margin: auto;" class="btn btn-primary btn-sm">Warn User</a>
											</div>
											<div style="height: 34%;width: 100%;display: flex;">
												<a onclick="return confirm('Ignore Report?')" href="reports/delete/<%= report.reportID %>" style="margin: auto;" class="btn btn-primary btn-sm">Ignore Report</a>
											</div>		
											<div style="height: 33%;width: 100%;display: flex;">
												<a href="items/list/<% item.forEach(function(item){ %>
																		<% if(item.itemID == report.itemID){ %>																		
																			<%= item.itemID %>
																		<% } %>
																	<% })%>" style="margin: auto;" class="btn btn-primary btn-sm">View Item</a>
											</div>		
										</div>												
									</div>
								</div>
							</div>			
						<% })%>
					</div>
				<% } else { %> 
					<div id="memberItems">
						<div style="height: 80px;width: 100%;">
							<h1 style="float: left;">My listed items</h1>
							<a href="/items/add" class="btn btn-danger btn-lg" style="float: right;">Post an item</a>
						</div>
						<% item.forEach(function(item){ %>
							<% if(item.status == 'Auction'){ %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="img">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>						
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="width: 50%;float: left;display: flex;">Starting Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.basePrice %>
																<% } %>														
															<%})%>
														</p>
														<p style="width: 50%;float: left;display: flex;">Current Bid: $
															<% auction.forEach(function(auction){%>
																<% if(auction.itemAuctionID == item.itemID){ %>
																	<%= auction.highestPrice %>
																<% } %>														
															<%})%>	
														</p>
													</div>													
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Status: <%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<div style="height: 100%;width: 15%;float: right;">
												<div style="height: 100%; width: 100%;">
													<div style="height: 50%;width: 100%;display: flex">
														<a onclick="return confirm('Are you sure you want to delete auction?')" href="items/canAuction/<%=item.itemID%>" style="margin: auto;" class="btn btn-primary btn-sm">Cancel Auction</a>
													</div>
													<div style="height: 50%;width: 100%;display: flex;">
													<a href="/auctions/
													<% auction.forEach(function(auction){%>
														<% if(auction.itemAuctionID == item.itemID){ %>
															<%= auction.auctionID %>
														<% } %>														
													<%})%>/
													<% auction.forEach(function(auction){%>
														<% if(auction.itemAuctionID == item.itemID){ %>
															<%= auction.itemAuctionID %>
														<% } %>														
													<%})%>" style="margin: auto;" class="btn btn-primary btn-sm">View Auction</a>
													</div>		
												</div>												
											</div>
										</div>
									</div>									
								</form>
							<% } else { %>
								<form action="/items/edit" method="post">
									<div style="height: 245px;width: 100%;overflow: hidden;display: flex;">										
										<div class="container" style="height: 95%;width: 100%;margin: auto;border: 1px solid rgb(176, 179, 172);border-radius: 7px;">
											<div style="height: 100%;width: 30%;float: left;display: flex;">												
												<img src="../itemImg/<%= item.itemPic %>" style="height: 95%;width: 95%;border-radius: 7px;margin: auto;" alt="TET">												
											</div>
											<div style="height: 100%;width: 55%;float: left;font-family: calibri;">
												<div style="height: 55%;width: 100%;font-size: 32px;">
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Name: <%= item.name %></p>
													</div>
													<div style="height: 34%;width: 100%;display: flex;">
														<p style="margin: auto 0;">Price: $<%= item.price %></p>
													</div>
													<div style="height: 33%;width: 100%;display: flex;">
														<p style="margin: auto 0;<%if(item.status == 'Deactivated'){%>color:red;<%}%>">Status:<%= item.status %></p>
													</div>
												</div>
												<div style="height: 45%;width: 100%;font-size: 23px;display: flex;">
													<p style="height: 90%;width: 90%;margin: auto;text-align: justify;overflow-y: auto;border: 1px solid grey;border-radius: 7px;"><%= item.detail %></p>
												</div>
											</div>
											<%if(item.status == 'Deactivated'){%>
												<div style="height: 100%;width: 15%;float: right;display: flex;">
													<div style="height: 80%; width: 80%;margin: auto;font-size: 32px;display: flex;">
														<p style="margin: auto;">Please seek help</p> 
													</div>												
												</div>
											<%}else{%>
												<div style="height: 100%;width: 15%;float: right;">
													<div style="height: 100%; width: 100%;">
														<div style="height: 33%;width: 100%;display: flex">
															<a href="items/auction/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Auction</a>
														</div>
														<div style="height: 34%;width: 100%;display: flex;">
															<a href="items/edit/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Edit</a>
														</div>												
														<div style="height: 33%;width: 100%;display: flex">
															<a onclick="return confirm('Are you sure you want to delete?')" href="items/delete/<%=item.itemID%>" style="margin: auto;width: 100%;font-size: 18px;" class="btn btn-primary btn-sm">Delete</a>
														</div>
													</div>												
												</div>	
											<%}%>
										</div>
									</div>									
								</form>
							<% } %>					
						<% })%>
					</div>
				<% } %>		
			<% } else { %> 
				<div>
					<h1 style="float: left;">No items listed</h1>
					<a href="/items/add" class="btn btn-danger btn-lg" style="float: right;">Post an item</a>
				</div>	
			<% } %>
		</div>
		<br>
		<script>
			function reportsF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				var redBtn = document.getElementById("redBtn");
				i.style.display = "none";
				u.style.display = "none";
				r.style.display = "block";
				redBtn.innerHTML = "";
				redBtn.style.display = 'none';
			}			
			function itemsF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				i.style.display = "block";
				u.style.display = "none";
				r.style.display = "none";
				redBtn.innerHTML = "Add an item";
				redBtn.href = "items/add";
				redBtn.style.display = 'block';
			}			
			function usersF() { 
				var i = document.getElementById("adminItems");
				var u = document.getElementById("adminUsers");
				var r = document.getElementById("adminReports");
				i.style.display = "none";
				u.style.display = "block";
				r.style.display = "none";
				redBtn.innerHTML = "Add an user";
				redBtn.href = "items/userAdd";
				redBtn.style.display = 'block';
			}			
		</script>
		<% include ../partials/footer %>
		<!-- jQuery Plugins -->
		<% include ../partials/javascript %>
		<script>
		</script>
</body>

</html>