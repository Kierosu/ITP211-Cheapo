<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<title><%= title %></title>
	<!-- PayPal API -->
	<script src="https://www.paypalobjects.com/api/checkout.js"></script>
	<script src="https://js.stripe.com/v3/"></script>
	<script src="https://checkout.stripe.com/checkout.js"></script>

	<!-- Google font -->
	<link href="https://fonts.googleapis.com/css?family=Hind:400,700" rel="stylesheet">

	<!-- Bootstrap -->
	<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />

	<!-- Slick -->
	<link type="text/css" rel="stylesheet" href="css/slick.css" />
	<link type="text/css" rel="stylesheet" href="css/slick-theme.css" />

	<!-- nouislider -->
	<link type="text/css" rel="stylesheet" href="css/nouislider.min.css" />

	<!-- Font Awesome Icon -->
	<link rel="stylesheet" href="css/font-awesome.min.css">

	<!-- Custom stylesheet -->
	<link type="text/css" rel="stylesheet" href="css/raysonStyle.css" />


</head>

<body>
	<% include ../partials/header %>
	<!-- BREADCRUMB -->
	<div id="breadcrumb">
		<div class="container">
			<ul class="breadcrumb">
				<li>
					<a href="#">Home</a>
				</li>
				<li class="active">Shopping Cart</li>
			</ul>
		</div>
	</div>
	<!-- /BREADCRUMB -->

	<!-- section -->
	<center>
		<div class="section">
			<div class="checkout-panel">
				<div class="panel-body">
					<h2 class="title">Step 3: Checkout</h2>

					<div class="bar">
						<div class="step active"></div>
						<div class="step active"></div>
						<div class="step"></div>
						<div class="step"></div>
					</div>
					<div id="charge-error" class="alert alert-danger hidden">
						
					</div>
					<div class="payment-method">
						<label for="card" class="method card">
							<div class="card-logos">
								<img src="img/visa_logo.png" />
								<img src="img/mastercard_logo.png" />
							</div>

							<div class="radio-input">
								<input id="card" type="radio" name="payment"> Pay $<%= total %> with credit card
							</div>
						</label>

						<label for="paypal" class="method paypal">
							<img src="img/paypal_logo.png" />
							<div class="radio-input">
								<input id="paypal" type="radio" name="payment"> Pay $<%= total %> with PayPal
							</div>
						</label>
					</div>
					<br><br>
					<div id="paypal-button-container"></div>
					<form action="/charge" method="POST" id="checkoutForm">
					<div class="stripe">
							<h3 class="title">Card Details:</h3>
							<div class="input-fields">
									<div class="column-1">
										<label for="cardholder">Cardholder's Name</label>
										<input type="text" id="cardholder" name="nameCard"/>
								
										<div class="small-inputs">
										<div>
											<label for="date">Valid thru</label>
											<input type="text" id="date" placeholder="MM / YY" />
										</div>
								
										<div>
											<label for="verification">CVV / CVC *</label>
											<input type="password" id="verification"/>
										</div>
										</div>
								
									</div>
									<div class="column-2">
										<label for="cardnumber">Card Number</label>
										<input id="cardnumber" name="number"/>
								
										<span class="info">* CVV or CVC is the card security code, unique three digits number on the back of your card separate from its number.</span>
									</div>
									</div>
									<br>
									<br>
									<h3 class="title">Shipping Details:</h3>
								<div class="input-fields">
										<div class="column-1">
											<label for="cardholder">Shipping Address:</label>
											<input type="text" id="shippingAddress" placeholder="Ang Mo Kio Ave 5, Singapore"/>
										</div>
										<center>
										<div class="column-2">
											<label for="cardnumber">Block/Unit-Number</label>
											<input type="password" id="blockUnit"/>
										</div>
										</center>
					
										</div>
										<button id="customButton">Purchase</button>
										</div>
									</div>
							<!-- <form action="/charge" method="POST">
								<script
								src = "https://checkout.stripe.com/checkout.js"
								class = "stripe-button"
								data-key = "pk_test_xaN8YLYB6jMqtqfguHvjft8f"
								data-amount = "<%= stripeTotal %>"
								data-name = "Credit Card Details"
								data-description = "Items from Cheapo."
								data-locale = "auto"
								data-currency = "SGD"
								></script> -->
						<div class="panel-footer">
							<button class="btn back-btn">Back</button>
							<button class="btn next-btn" onclick="addDetails()">Next Step</button>
						</div>
						</div>
						<input type="hidden" name = "chargeAmount" value="<%= stripeTotal %>">
					</div>
				</div>
				<br>
				<br>
				<br>
				<br>
				<div class="panel-footer">
					<a href="/shopping-cart" class="btn back-btn">Back</a>
				</div>
			</form>
			</div>

		</div>
	</center>
	<!-- /section -->

	<% include ../partials/footer %>
	<script>
	//Inserting Data with ajax
	function addDetails() {
		var url = "<%=hostPath%>/checkout/<%= userID%>"; //Edit when database is added
		var cardDetails = {
			userID: "<%= userID %>",
			cardName: $("#cardholder").val(),
			cardNumber: $("#cardnumber").val(),
			expiryDate: $("#date").val(),
			verification: $("#verification").val(),
			shippingAddress: $("#shippingAddress").val(),
			blockUnit: $("#blockUnit").val()
		}

		$.ajax({
			url: url,
			type: "POST",
			data: JSON.stringify(cardDetails),
			dataType: "json",
			contentType: "application/json",
			success: function(result){
				alert("Card Details  Entered.")
			},
			error: function(result){
				alert("Card Details Failed")
				discardDetails();
			}
		})
	}

	function discordDetails() {
		location.href = "<%=hostPath%>/checkout"
	}
	
	</script>
	<!-- jQuery Plugins -->
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/slick.min.js"></script>
	<script src="js/nouislider.min.js"></script>
	<script src="js/jquery.zoom.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/backendcheckout.js"></script>
	<script src="js/stripeCheckout.js"></script>
	<script>

    // Render the PayPal button
	var realTotal = parseFloat('<%= total %>');
	paypal.Button.render({

		env: 'sandbox', // sandbox | production

		style: {
            label: 'paypal',
            size:  'medium',    // small | medium | large | responsive
            shape: 'rect',     // pill | rect
            color: 'blue',     // gold | blue | silver | black
            tagline: false    
        },

		// PayPal Client IDs - replace with your own
		// Create a PayPal app: https://developer.paypal.com/developer/applications/create
		client: {
			sandbox:    'AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R',
			production: '<insert production client id>'
		},

		// Show the buyer a 'Pay Now' button in the checkout flow
		commit: true,

		// payment() is called when the button is clicked
		payment: function(data, actions) {

			// Make a call to the REST api to create the payment
			return actions.payment.create({
				payment: {
					transactions: [
						{
							amount: { total: realTotal, currency: 'SGD' }
						}
					]
				}
			});
		},

		// onAuthorize() is called when the buyer approves the payment
		onAuthorize: function(data, actions) {

			// Make a call to the REST api to execute the payment
			return actions.payment.execute().then(function() {
				window.alert('Payment Complete!');
				window.location.replace("http://localhost:3000/done");
			});
		}

		}, '#paypal-button-container');

	</script>
</body>

</html>

